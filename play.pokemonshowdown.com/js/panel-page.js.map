{"version":3,"file":"panel-page.js","names":["SanitizedHTML","props","preact","h","dangerouslySetInnerHTML","__html","BattleLog","sanitizeHTML","children","PageRoom","_PSRoom","options","_this","call","classType","page","id","split","canConnect","loading","htmlData","setHTMLData","update","connect","title","_inheritsLoose","_proto","prototype","connected","PagePanel","clientRooms","hasOwnProperty","PS","send","connectWhenLoggedIn","PSRoom","PageLadderHelp","href","target","_PSRoomPanel","apply","arguments","_proto2","receiveLine","args","room","body","notify","dismissNotification","pageHTMLContainer","base","querySelector","selectedElement","innerHTML","slice","join","subtleNotify","render","renderPage","undefined","PSPanelWrapper","scrollable","PSRoomPanel","routes","Model","addRoomType"],"sources":["../src/panel-page.tsx"],"sourcesContent":["/**\n * Page Panel\n *\n * Panel for static content and server-rendered HTML.\n *\n * @author Adam Tran <aviettran@gmail.com>\n * @license MIT\n */\n\nimport { PS, PSRoom, type RoomOptions } from \"./client-main\";\nimport { PSPanelWrapper, PSRoomPanel } from \"./panels\";\nimport { BattleLog } from \"./battle-log\";\nimport type { Args } from \"./battle-text-parser\";\n\nexport function SanitizedHTML(props: { children: string }) {\n\treturn <div dangerouslySetInnerHTML={{ __html: BattleLog.sanitizeHTML(props.children) }} />;\n}\n\nclass PageRoom extends PSRoom {\n\toverride readonly classType: string = 'html';\n\treadonly page?: string = this.id.split(\"-\")[1];\n\toverride readonly canConnect = true;\n\n\tloading = true;\n\thtmlData?: string;\n\n\tsetHTMLData = (htmlData?: string) => {\n\t\tthis.loading = false;\n\t\tthis.htmlData = htmlData;\n\t\tthis.update(null);\n\t};\n\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tthis.connect();\n\t\tthis.title = this.id.split('-')[1];\n\t}\n\toverride connect() {\n\t\tif (!this.connected && !PagePanel.clientRooms.hasOwnProperty(this.id.split('-')[1])) {\n\t\t\tPS.send(`/join ${this.id}`);\n\t\t\tthis.connected = true;\n\t\t\tthis.connectWhenLoggedIn = false;\n\t\t}\n\t}\n}\n\nfunction PageLadderHelp() {\n\treturn <div class=\"ladder pad\">\n\t\t<p>\n\t\t\t<button class=\"button\" data-href=\"/ladder\" data-target=\"replace\">\n\t\t\t\t<i class=\"fa fa-chevron-left\" aria-hidden></i> Format List\n\t\t\t</button>\n\t\t</p>\n\t\t<h3>How the ladder works</h3>\n\t\t<p>\n\t\t\tOur ladder displays three ratings: Elo, GXE, and Glicko-1.\n\t\t</p>\n\t\t<p>\n\t\t\t<strong>Elo</strong> is the main ladder rating. It's a pretty\n\t\t\tnormal ladder rating: goes up when you win and down when you\n\t\t\tlose.\n\t\t</p>\n\t\t<p>\n\t\t\t<strong>GXE</strong> (Glicko X-Act Estimate) is an estimate of\n\t\t\tyour win chance against an average ladder player.\n\t\t</p>\n\t\t<p>\n\t\t\t<strong>Glicko-1</strong> is {}\n\t\t\t<a href=\"https://en.wikipedia.org/wiki/Glicko_rating_system\">another rating system</a>.\n\t\t\tIt has rating and deviation values.\n\t\t</p>\n\t\t<p>\n\t\t\t<strong>COIL</strong> (Converging Order Invariant Ladder) is\n\t\t\tused for suspect tests. The more games you play, the closer\n\t\t\tit will get to your GXE &times; 4000. How fast it reaches\n\t\t\tGXE &times; 4000 depends on {}\n\t\t\t<a href=\"https://www.smogon.com/forums/threads/reintroducing-coil.3747719/\" target=\"_blank\">a custom B value</a> {}\n\t\t\twhich is different for each suspect test.\n\t\t</p>\n\t\t<p>\n\t\t\tNote that win/loss should not be used to estimate skill, since\n\t\t\twho you play against is much more important than how many times\n\t\t\tyou win or lose. Our other stats like Elo and GXE are much better\n\t\t\tfor estimating skill.\n\t\t</p>\n\t</div>;\n}\n\nclass PagePanel extends PSRoomPanel<PageRoom> {\n\tstatic readonly id = 'html';\n\tstatic readonly routes = ['view-*'];\n\tstatic readonly Model = PageRoom;\n\tstatic clientRooms: { [key: string]: JSX.Element } = { 'ladderhelp': <PageLadderHelp /> };\n\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\toverride receiveLine(args: Args) {\n\t\tconst { room } = this.props;\n\t\tswitch (args[0]) {\n\t\tcase 'title':\n\t\t\troom.title = args[1];\n\t\t\tPS.update();\n\t\t\treturn true;\n\t\tcase 'tempnotify': {\n\t\t\tconst [, id, title, body] = args;\n\t\t\troom.notify({ title, body, id });\n\t\t\treturn true;\n\t\t}\n\t\tcase 'tempnotifyoff': {\n\t\t\tconst [, id] = args;\n\t\t\troom.dismissNotification(id);\n\t\t\treturn true;\n\t\t}\n\t\tcase 'selectorhtml':\n\t\t\tconst pageHTMLContainer = this.base!.querySelector('.page-html-container');\n\t\t\tconst selectedElement = pageHTMLContainer?.querySelector(args[1]);\n\t\t\tif (!selectedElement) return;\n\t\t\tselectedElement.innerHTML = BattleLog.sanitizeHTML(args.slice(2).join('|'));\n\t\t\troom.subtleNotify();\n\t\t\treturn true;\n\t\tcase 'noinit':\n\t\t\tif (args[1] === 'namerequired') {\n\t\t\t\troom.setHTMLData(args[2]);\n\t\t\t}\n\t\t\treturn true;\n\t\tcase 'pagehtml':\n\t\t\troom.setHTMLData(args[1]);\n\t\t\troom.subtleNotify();\n\t\t\treturn true;\n\t\t}\n\t}\n\toverride render() {\n\t\tconst { room } = this.props;\n\t\tlet renderPage;\n\t\tif (room.page !== undefined && PagePanel.clientRooms[room.page]) {\n\t\t\trenderPage = PagePanel.clientRooms[room.page];\n\t\t} else {\n\t\t\tif (room.loading) {\n\t\t\t\trenderPage = <p>Loading...</p>;\n\t\t\t} else {\n\t\t\t\trenderPage = <div class=\"page-html-container\">\n\t\t\t\t\t<SanitizedHTML>{room.htmlData || ''}</SanitizedHTML>\n\t\t\t\t</div>;\n\t\t\t}\n\t\t}\n\t\treturn <PSPanelWrapper room={room} scrollable>\n\t\t\t{renderPage}\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nPS.addRoomType(PagePanel);\n"],"mappings":"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","ignoreList":[]}