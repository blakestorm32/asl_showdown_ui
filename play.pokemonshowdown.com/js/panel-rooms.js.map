{"version":3,"file":"panel-rooms.js","names":["RoomsRoom","_PSRoom","options","_this","call","classType","PS","send","_inheritsLoose","PSRoom","RoomsPanel","_PSRoomPanel","_this2","_len","arguments","length","args","Array","_key","apply","concat","hidden","search","section","lastKeyCode","roomList","roomListFocusIndex","roomListLength","hide","ev","stopImmediatePropagation","hideRightRoom","changeSearch","target","currentTarget","selectionStart","selectionEnd","updateRoomList","value","forceUpdate","changeSection","handleOnBlur","keyDownSearch","keyCode","shiftKey","ctrlKey","altKey","metaKey","Math","max","preventDefault","min","getRoomListFocusTitle","arrowIndex","indexOf","slice","test","toID","join","_proto","prototype","componentDidMount","subscriptions","push","user","subscribe","update","named","componentDidUpdate","_this$base","el","base","querySelector","scrollIntoView","behavior","block","forceNoAutocomplete","undefined","getRoomList","_i2","_this$roomList2","_ref","rooms","sort","a","b","userCount","searchid","roomsCache","mainmenu","spotLightLabel","officialRooms","chatRooms","hiddenRooms","spotLightRooms","_i4","_ref3","chat","room","privacy","spotlight","exactMatch","_i6","_roomList2","subRooms","_i8","_room$subRooms2","title","desc","results","filter","titleid","startsWith","replace","includes","toLowerCase","autoFill","firstTitle","firstTitleOffset","autoFillValue","oldSearch","searchElem","setSelectionRange","render","_rooms$sectionTitles","isVisible","props","preact","h","PSPanelWrapper","scrollable","style","onClick","href","battleCount","name","onChange","sectionTitles","map","type","placeholder","autocomplete","onInput","onKeyDown","onBlur","renderRoomList","_this$roomList$map$re","_ref4","reduce","_this3","isOffline","nextOffset","_ref5","sortedRooms","offset","index","roomInfo","i","key","roomName","PSRoomPanel","id","routes","Model","location","icon","addRoomType"],"sources":["../src/panel-rooms.tsx"],"sourcesContent":["/**\n * Room-list panel (default right-panel)\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\nimport { PS, PSRoom, type RoomID, type RoomOptions } from \"./client-main\";\nimport { PSPanelWrapper, PSRoomPanel } from \"./panels\";\nimport type { RoomInfo } from \"./panel-mainmenu\";\nimport { toID } from \"./battle-dex\";\n\nexport class RoomsRoom extends PSRoom {\n\toverride readonly classType: string = 'rooms';\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tPS.send(`/cmd rooms`);\n\t}\n}\n\ntype RoomsSection = [string, RoomInfo[]];\nclass RoomsPanel extends PSRoomPanel {\n\tstatic readonly id = 'rooms';\n\tstatic readonly routes = ['rooms'];\n\tstatic readonly Model = RoomsRoom;\n\tstatic readonly location = 'right';\n\tstatic readonly icon = <i class=\"fa fa-plus rooms-plus\" aria-hidden></i>;\n\tstatic readonly title = \"Chat Rooms\";\n\thidden = false;\n\tsearch = '';\n\tsection = '';\n\tlastKeyCode = 0;\n\troomList: RoomsSection[] = [];\n\troomListFocusIndex = -1;\n\troomListLength = 0;\n\toverride componentDidMount() {\n\t\tsuper.componentDidMount();\n\t\tthis.subscriptions.push(PS.user.subscribe(update => {\n\t\t\tif (!update && PS.user.named) PS.send(`/cmd rooms`);\n\t\t}));\n\t}\n\toverride componentDidUpdate() {\n\t\tconst el = this.base?.querySelector('a.blocklink.cur');\n\t\tif (!this.roomListFocusIndex) return;\n\t\tel?.scrollIntoView({ behavior: 'auto', block: 'center' });\n\t}\n\thide = (ev: Event) => {\n\t\tev.stopImmediatePropagation();\n\t\tPS.hideRightRoom();\n\t};\n\tchangeSearch = (ev: Event) => {\n\t\tconst target = ev.currentTarget as HTMLInputElement;\n\t\tif (target.selectionStart !== target.selectionEnd) return;\n\t\tthis.updateRoomList(target.value);\n\t\tthis.forceUpdate();\n\t};\n\tchangeSection = (ev: Event) => {\n\t\tconst target = ev.currentTarget as HTMLSelectElement;\n\t\tthis.section = target.value;\n\t\tthis.forceUpdate();\n\t};\n\thandleOnBlur = (ev: Event) => {\n\t\tthis.roomListFocusIndex = -1;\n\t\tthis.forceUpdate();\n\t};\n\tkeyDownSearch = (ev: KeyboardEvent) => {\n\t\tthis.lastKeyCode = ev.keyCode;\n\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey || ev.metaKey) return;\n\t\tif (ev.keyCode === 38) { // up\n\t\t\tthis.roomListFocusIndex = Math.max(this.roomListFocusIndex - 1, this.search ? 0 : -1);\n\t\t\tthis.forceUpdate();\n\t\t\tev.preventDefault();\n\t\t} else if (ev.keyCode === 40) { // down\n\t\t\tthis.roomListFocusIndex = Math.min(this.roomListFocusIndex + 1, this.roomListLength - 1);\n\t\t\tthis.forceUpdate();\n\t\t\tev.preventDefault();\n\t\t} else if (ev.keyCode === 13) { // enter\n\t\t\tconst target = ev.currentTarget as HTMLInputElement;\n\t\t\tlet value = this.getRoomListFocusTitle() || target.value;\n\t\t\tconst arrowIndex = value.indexOf(' \\u21d2 ');\n\t\t\tif (arrowIndex >= 0) value = value.slice(arrowIndex + 3);\n\t\t\tif (!/^[a-z0-9-]$/.test(value)) value = toID(value);\n\t\t\tev.preventDefault();\n\t\t\tev.stopImmediatePropagation();\n\t\t\ttarget.value = '';\n\t\t\tthis.updateRoomList('');\n\n\t\t\tPS.join(value as RoomID);\n\t\t}\n\t};\n\tupdateRoomList(search?: string) {\n\t\tif (search) search = toID(search);\n\t\tconst forceNoAutocomplete = this.search === `${search || ''}-`;\n\t\tif (search || this.search) {\n\t\t\tif (search === undefined || search === this.search) return;\n\t\t\tthis.search = search;\n\t\t\tthis.roomListFocusIndex = this.search ? 0 : -1;\n\t\t}\n\t\tthis.roomList = this.getRoomList(forceNoAutocomplete);\n\t\tfor (const [, rooms] of this.roomList) {\n\t\t\trooms.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\n\t\t}\n\t}\n\tgetRoomList(forceNoAutocomplete?: boolean): RoomsSection[] {\n\t\tconst searchid = toID(this.search);\n\n\t\tif (!searchid) {\n\t\t\tconst roomsCache = PS.mainmenu.roomsCache;\n\t\t\tlet spotLightLabel = '';\n\t\t\tconst officialRooms = [], chatRooms = [], hiddenRooms = [], spotLightRooms = [];\n\t\t\tfor (const room of roomsCache.chat || []) {\n\t\t\t\tif (room.section !== this.section && this.section !== '') continue;\n\t\t\t\tif (room.privacy === 'hidden') {\n\t\t\t\t\thiddenRooms.push(room);\n\t\t\t\t} else if (room.spotlight) {\n\t\t\t\t\tspotLightLabel = room.spotlight;\n\t\t\t\t\tspotLightRooms.push(room);\n\t\t\t\t} else if (room.section === 'Official') {\n\t\t\t\t\tofficialRooms.push(room);\n\t\t\t\t} else {\n\t\t\t\t\tchatRooms.push(room);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn [\n\t\t\t\t[\"Official chat rooms\", officialRooms],\n\t\t\t\t[spotLightLabel, spotLightRooms],\n\t\t\t\t[\"Chat rooms\", chatRooms],\n\t\t\t\t[\"Hidden rooms\", hiddenRooms],\n\t\t\t];\n\t\t}\n\n\t\tlet exactMatch = false;\n\n\t\tconst rooms = PS.mainmenu.roomsCache;\n\t\tlet roomList = [...(rooms.chat || [])];\n\t\tfor (const room of roomList) {\n\t\t\tif (!room.subRooms) continue;\n\t\t\tfor (const title of room.subRooms) {\n\t\t\t\troomList.push({\n\t\t\t\t\ttitle,\n\t\t\t\t\tdesc: `(Subroom of ${room.title})`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tlet results = roomList.filter(room => {\n\t\t\tconst titleid = toID(room.title);\n\t\t\tif (titleid === searchid) exactMatch = true;\n\t\t\treturn titleid.startsWith(searchid) ||\n\t\t\t\ttoID(room.title.replace(/^The /, '')).startsWith(searchid);\n\t\t});\n\t\troomList = roomList.filter(room => !results.includes(room));\n\n\t\tresults = results.concat(roomList.filter(room =>\n\t\t\ttoID(room.title.toLowerCase().replace(/\\b([a-z0-9])[a-z0-9]*\\b/g, '$1')).startsWith(searchid) ||\n\t\t\troom.title.replace(/[^A-Z0-9]+/g, '').toLowerCase().startsWith(searchid)\n\t\t));\n\n\t\tconst hidden: RoomsSection[] = !exactMatch ?\n\t\t\t[[\"Possible secret room\", [{ title: this.search, desc: \"(Private room?)\" }]]] : [];\n\n\t\tconst autoFill = this.lastKeyCode !== 127 && this.lastKeyCode >= 32;\n\t\tif (autoFill && !forceNoAutocomplete) {\n\t\t\tresults.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\n\t\t\tconst firstTitle = (results[0] || hidden[0][1][0]).title;\n\t\t\tlet firstTitleOffset = 0;\n\t\t\twhile (\n\t\t\t\tsearchid !== toID(firstTitle.slice(0, firstTitleOffset)) &&\n\t\t\t\tfirstTitleOffset < firstTitle.length // should never happen, but sanity against infinite loop\n\t\t\t) {\n\t\t\t\tfirstTitleOffset++;\n\t\t\t}\n\t\t\tlet autoFillValue = firstTitle.slice(firstTitleOffset);\n\t\t\tif (!autoFillValue && toID(firstTitle) !== searchid) {\n\t\t\t\tautoFillValue = ' \\u21d2 ' + firstTitle;\n\t\t\t}\n\t\t\tconst oldSearch = this.search;\n\t\t\tconst searchElem = this.base!.querySelector<HTMLInputElement>('input[type=search]')!;\n\t\t\tif (autoFillValue) {\n\t\t\t\tsearchElem.value = oldSearch + autoFillValue;\n\t\t\t\tsearchElem.setSelectionRange(oldSearch.length, oldSearch.length + autoFillValue.length);\n\t\t\t\tthis.search += '-';\n\t\t\t}\n\n\t\t\treturn [[\"Search results\", results], ...hidden];\n\t\t}\n\n\t\treturn [...hidden, [\"Search results\", results]];\n\t}\n\toverride render() {\n\t\tif (this.hidden && PS.isVisible(this.props.room)) this.hidden = false;\n\t\tif (this.hidden) {\n\t\t\treturn <PSPanelWrapper room={this.props.room} scrollable>{null}</PSPanelWrapper>;\n\t\t}\n\t\tconst rooms = PS.mainmenu.roomsCache;\n\t\tthis.updateRoomList();\n\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable><div class=\"pad\">\n\t\t\t<button class=\"button\" style=\"float:right;font-size:10pt;margin-top:3px\" onClick={this.hide}>\n\t\t\t\t<i class=\"fa fa-caret-right\" aria-hidden></i> Hide\n\t\t\t</button>\n\t\t\t<div class=\"roomcounters\">\n\t\t\t\t<a class=\"button\" href=\"users\" title=\"Find an online user\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"pixelated usercount\"\n\t\t\t\t\t\ttitle=\"Meloetta is PS's mascot! The Aria forme is about using its voice, and represents our chatrooms.\"\n\t\t\t\t\t></span>\n\t\t\t\t\t<strong>{rooms.userCount || '-'}</strong> users online\n\t\t\t\t</a> {}\n\t\t\t\t<a class=\"button\" href=\"battles\" title=\"Watch an active battle\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"pixelated battlecount\"\n\t\t\t\t\t\ttitle=\"Meloetta is PS's mascot! The Pirouette forme is Fighting-type, and represents our battles.\"\n\t\t\t\t\t></span>\n\t\t\t\t\t<strong>{rooms.battleCount || '-'}</strong> active battles\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<select name=\"sections\" class=\"button\" onChange={this.changeSection}>\n\t\t\t\t\t<option value=\"\">(All rooms)</option>\n\t\t\t\t\t{rooms.sectionTitles?.map(title => {\n\t\t\t\t\t\treturn <option value={title}> {title} </option>;\n\t\t\t\t\t})}\n\t\t\t\t</select>\n\t\t\t\t<br /><br />\n\t\t\t\t<input\n\t\t\t\t\ttype=\"search\" name=\"roomsearch\" class=\"textbox autofocus\" style=\"width: 100%; max-width: 480px\"\n\t\t\t\t\tplaceholder=\"Join or search for rooms\" autocomplete=\"off\"\n\t\t\t\t\tonInput={this.changeSearch} onKeyDown={this.keyDownSearch} onBlur={this.handleOnBlur}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t{this.renderRoomList()}\n\t\t</div></PSPanelWrapper>;\n\t}\n\tgetRoomListFocusTitle(): string | undefined {\n\t\treturn this.roomList.map(([, rooms]) => rooms).reduce((a, b) => a.concat(b))[this.roomListFocusIndex]?.title;\n\t}\n\trenderRoomList() {\n\t\tconst roomsCache = PS.mainmenu.roomsCache;\n\t\tif (roomsCache.userCount === undefined) {\n\t\t\treturn <div class=\"roomlist\"><h2>Official chat rooms</h2><p><em>Connecting...</em></p></div>;\n\t\t}\n\t\tif (this.search) {\n\t\t\t// do nothing\n\t\t} else if (PS.isOffline) {\n\t\t\treturn <div class=\"roomlist\"><h2>Offline</h2></div>;\n\t\t} else if (roomsCache.userCount === undefined) {\n\t\t\treturn <div class=\"roomlist\"><h2>Official chat rooms</h2><p><em>Connecting...</em></p></div>;\n\t\t}\n\n\t\t// Descending order\n\t\tlet nextOffset = 0;\n\t\treturn this.roomList.map(([title, rooms]) => {\n\t\t\tif (!rooms.length) return null;\n\n\t\t\tconst sortedRooms = rooms.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\n\t\t\tconst offset = nextOffset;\n\t\t\tnextOffset += sortedRooms.length;\n\t\t\tthis.roomListLength = nextOffset;\n\n\t\t\tconst index = this.roomListFocusIndex >= offset && this.roomListFocusIndex < nextOffset ?\n\t\t\t\tthis.roomListFocusIndex - offset : -1;\n\n\t\t\treturn <div class=\"roomlist\">\n\t\t\t\t<h2>{title}</h2>\n\t\t\t\t{sortedRooms.map((roomInfo, i) => <div key={roomInfo.title}>\n\t\t\t\t\t<a href={`/${toID(roomInfo.title)}`} class={`blocklink${i === index ? \" cur\" : ''}`}>\n\t\t\t\t\t\t{roomInfo.userCount !== undefined && <small style=\"float:right\">({roomInfo.userCount} users)</small>}\n\t\t\t\t\t\t<strong><i class=\"fa fa-comment-o\" aria-hidden></i> {roomInfo.title}<br /></strong>\n\t\t\t\t\t\t<small>{roomInfo.desc || ''}</small>\n\t\t\t\t\t</a>\n\t\t\t\t\t{roomInfo.subRooms && <div class=\"subrooms\">\n\t\t\t\t\t\t<i class=\"fa fa-level-up fa-rotate-90\" aria-hidden></i> Subrooms: {}\n\t\t\t\t\t\t{roomInfo.subRooms.map(roomName => [<a href={`/${toID(roomName)}`} class=\"blocklink\">\n\t\t\t\t\t\t\t<i class=\"fa fa-comment-o\" aria-hidden></i> <strong>{roomName}</strong>\n\t\t\t\t\t\t</a>, ' '])}\n\t\t\t\t\t</div>}\n\t\t\t\t</div>)}\n\t\t\t</div>;\n\t\t});\n\t}\n}\n\nPS.addRoomType(RoomsPanel);\n"],"mappings":"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","ignoreList":[]}