{
  auto_https off
  admin off
}

http://:{$PORT} {
  root * /app/play.pokemonshowdown.com
  encode zstd gzip

  log {
    output stdout
    format console
    level DEBUG
  }

  # Serve config/*.json with CORS like the Apache rules
  @config path /config/*
  header @config Access-Control-Allow-Origin "*"
  header @config Access-Control-Allow-Methods "GET,POST,OPTIONS"
  header @config Access-Control-Allow-Headers "Content-Type, X-Requested-With"

  # Handle PHP files (crossdomain.php, etc.)
  @php path *.php
  handle @php {
    php_server
  }

  # Serve static assets directly (correct MIME types)
  @static {
    file
    path *.js *.css *.json *.png *.jpg *.jpeg *.gif *.svg *.ico *.webp *.avif *.woff *.woff2 *.ttf *.eot
  }
  handle @static {
    file_server
  }

  # SPA/client-side routing fallback (ONLY if nothing matched above)
  handle {
    try_files {path} {path}/ /index.html
  }
}
