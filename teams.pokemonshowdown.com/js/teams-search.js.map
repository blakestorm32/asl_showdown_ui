{"version":3,"file":"teams-search.js","names":["SEARCH_KEYS","TeamSearcher","_preact$Component","props","_this","call","state","result","curCount","search","loading","searchUnchanged","url","URL","location","href","makeSearch","_i2","length","key","val","searchParams","get","toID","args","type","propVal","count","Number","isNaN","_inheritsLoose","_proto","prototype","onInput","_ref","currentTarget","value","setState","_BattleAliases","_this2","incrementCount","arguments","undefined","noSetUrl","stateUnchanged","k","set","history","pushState","format","BattleAliases","startsWith","gen","query","Object","assign","then","render","_this3","preact","h","style","wordWrap","textAlign","Config","routes","teams","name","e","owner","onClick","Fragment","map","team","MiniTeam","fullTeam","actionerror","Component"],"sources":["../src/teams-search.tsx"],"sourcesContent":["/** @jsx preact.h */\n/** @jsxFrag preact.Fragment */\nimport preact from '../../play.pokemonshowdown.com/js/lib/preact';\nimport { type ServerTeam, MiniTeam, query } from './utils';\nimport type { PageProps } from './teams';\nimport { Config } from '../../play.pokemonshowdown.com/src/client-main';\n\ndeclare const toID: (val: any) => string;\ndeclare const BattleAliases: Record<string, string>;\n\nconst SEARCH_KEYS = ['format', 'owner', 'gen'];\n\nexport class TeamSearcher extends preact.Component<PageProps> {\n\toverride state = {\n\t\tresult: [] as ServerTeam[],\n\t\tcurCount: 20,\n\t\tsearch: {} as Record<string, string>,\n\t\tloading: false,\n\t\tsearchUnchanged: null as null | boolean,\n\t};\n\tconstructor(props: PageProps) {\n\t\tsuper(props);\n\n\t\tconst url = new URL(location.href);\n\t\tlet makeSearch = false;\n\t\tfor (const key of SEARCH_KEYS) {\n\t\t\tconst val = url.searchParams.get(key);\n\t\t\tif (toID(val)) {\n\t\t\t\tthis.state.search[key] = toID(val);\n\t\t\t\tmakeSearch = true;\n\t\t\t}\n\t\t\tif (this.props.args.type === key) { // prioritize url where applicable\n\t\t\t\tconst propVal = toID(this.props.args.val);\n\t\t\t\tif (propVal) {\n\t\t\t\t\tthis.state.search[key] = propVal;\n\t\t\t\t\tmakeSearch = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst count = Number(url.searchParams.get('count'));\n\t\tif (!isNaN(count) && count > 0) {\n\t\t\tthis.state.curCount = count;\n\t\t}\n\t\tif (makeSearch) {\n\t\t\tthis.search(0, true);\n\t\t}\n\t}\n\t// todo: find proper type. preact docs unhelpful.\n\tonInput(key: string, { currentTarget }: any) {\n\t\tthis.state.search[key] = toID(currentTarget.value);\n\t\tthis.setState({ search: this.state.search });\n\t}\n\t// format, owner, gen, count params. maxes out at 200. start at 20 and paginate\n\tsearch(incrementCount = 0, noSetUrl = false) {\n\t\tthis.state.curCount += incrementCount;\n\t\tthis.setState({\n\t\t\tloading: true,\n\t\t\tstateUnchanged: true,\n\t\t\tcurCount: this.state.curCount,\n\t\t});\n\n\t\tconst url = new URL(location.href);\n\t\t// clear out old ones so they don't dupe\n\t\tfor (const val in url.searchParams) url.searchParams.delete(val);\n\t\t// then set new ones\n\t\tfor (const k in this.state.search) {\n\t\t\turl.searchParams.set(k, this.state.search[k]);\n\t\t}\n\t\turl.searchParams.set('count', `${this.state.curCount}`);\n\t\tif (!noSetUrl) history.pushState({}, '', url);\n\n\t\tlet format = this.state.search.format ?\n\t\t\ttoID(BattleAliases?.[this.state.search.format]) || this.state.search.format :\n\t\t\tundefined;\n\n\t\tif (format) {\n\t\t\tif (!format.startsWith('gen')) {\n\t\t\t\tformat = `gen${this.state.search.gen || 9}${format}`;\n\t\t\t\tdelete this.state.search.gen; // don't let them conflict\n\t\t\t}\n\t\t} else {\n\t\t\tformat = undefined;\n\t\t}\n\t\tfor (const k in this.state.search) {\n\t\t\tif (!this.state.search[k]) delete this.state.search[k];\n\t\t}\n\t\tvoid query('searchteams', {\n\t\t\tquery: { ...this.state.search, format, count: this.state.curCount },\n\t\t}).then(result => {\n\t\t\tthis.setState({ ...result, loading: false });\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.state.loading) {\n\t\t\treturn <div class=\"section\" style={{ wordWrap: 'break-word' }}>Loading...</div>;\n\t\t}\n\t\treturn <div class=\"section\" style={{ wordWrap: 'break-word', textAlign: 'center' }}>\n\t\t\t<small><a href={'//' + Config.routes.teams}><i style={{ float: 'left' }} class=\"fa fa-arrow-left\"></i></a></small>\n\t\t\t<h1>Search Teams</h1>\n\t\t\t<br />\n\t\t\t<div name=\"searchsection\">\n\t\t\t\t<label>Format: </label>\n\t\t\t\t<input value={this.state.search.format} onInput={e => this.onInput('format', e)} /><br />\n\t\t\t\t<label>Owner: </label>\n\t\t\t\t<input value={this.state.search.owner} onInput={e => this.onInput('owner', e)} /><br />\n\t\t\t\t<label>Generation: </label>\n\t\t\t\t<input value={this.state.search.gen} onInput={e => this.onInput('gen', e)} /><br />\n\t\t\t\t<button class=\"button notifying\" onClick={() => this.search()}>Search!</button>\n\t\t\t</div>\n\t\t\t<hr />\n\t\t\t{!this.state.result.length ? <></> :\n\t\t\t<ul class=\"teamlist\">{\n\t\t\t\tthis.state.result.map(team => <li><MiniTeam team={team} fullTeam /></li>)\n\t\t\t}</ul>}\n\t\t\t{(this.state.result as any).actionerror ?\n\t\t\t\t<div class=\"message-error\">{(this.state.result as any).actionerror}</div> :\n\t\t\t\t<></>}\n\t\t\t{\n\t\t\t\tthis.state.result.length === this.state.curCount ?\n\t\t\t\t\t<button class=\"button notifying\" onClick={() => this.search(20)}>More</button> :\n\t\t\t\t\t<></>\n\t\t\t}\n\t\t</div>;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}